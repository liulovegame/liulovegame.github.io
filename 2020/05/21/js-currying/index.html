<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><title>JavaScript的柯里化 | 博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/live2d.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JavaScript的柯里化</h1><a id="logo" href="/.">博客</a><p class="description">简而不单</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JavaScript的柯里化</h1><div class="post-meta">May 21, 2020</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#通用实现"><span class="toc-number">1.</span> <span class="toc-text">通用实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高阶柯里化函数"><span class="toc-number">2.</span> <span class="toc-text">高阶柯里化函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#疯狂柯里化函数"><span class="toc-number">3.</span> <span class="toc-text">疯狂柯里化函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#柯里化的常见用法"><span class="toc-number">4.</span> <span class="toc-text">柯里化的常见用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参数复用"><span class="toc-number">4.1.</span> <span class="toc-text">参数复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提高适用性"><span class="toc-number">4.2.</span> <span class="toc-text">提高适用性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#延迟执行"><span class="toc-number">4.3.</span> <span class="toc-text">延迟执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数柯里化的递归调用"><span class="toc-number">4.4.</span> <span class="toc-text">函数柯里化的递归调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数组合-compose"><span class="toc-number">4.5.</span> <span class="toc-text">函数组合(compose)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-prototype-bind-方法也是柯里化应用"><span class="toc-number">4.6.</span> <span class="toc-text">Function.prototype.bind 方法也是柯里化应用</span></a></li></ol></li></ol></div></div><div class="post-content"><p>柯里化（Currying），又称部分求值（Partial Evaluation），是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。</p>
<p>核心思想是把多参数传入的函数拆成单参数（或部分）函数，内部再返回调用下一个单参数（或部分）函数，依次处理剩余的参数。</p>
<p>按照Stoyan Stefanov –《JavaScript Pattern》作者 的说法，所谓“柯里化”就是使函数理解并处理部分应用</p>
<p>柯里化有3个常见作用：</p>
<ol>
<li>参数复用</li>
<li>提前返回</li>
<li>延迟计算/运行</li>
</ol>
<h2 id="通用实现"><a href="#通用实现" class="headerlink" title="通用实现"></a>通用实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">currying</span>(<span class="params">fn, ...rest1</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...rest2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="literal">null</span>, rest1.concat(rest2))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这里concat接受非数组元素参数将被当做调用者的一个元素传入</p>
<p>用它将一个sayHello函数柯里化试试：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">name, age, fruit</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">console</span>.log(<span class="string">`我叫 <span class="subst">$&#123;name&#125;</span>,我 <span class="subst">$&#123;age&#125;</span> 岁了, 我喜欢吃 <span class="subst">$&#123;fruit&#125;</span>`</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curryingShowMsg1 = currying(sayHello, <span class="string">'小明'</span>)</span><br><span class="line">curryingShowMsg1(<span class="number">22</span>, <span class="string">'苹果'</span>)            <span class="comment">// 我叫 小明,我 22 岁了, 我喜欢吃 苹果</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curryingShowMsg2 = currying(sayHello, <span class="string">'小衰'</span>, <span class="number">20</span>)</span><br><span class="line">curryingShowMsg2(<span class="string">'西瓜'</span>)               <span class="comment">// 我叫 小衰,我 20 岁了, 我喜欢吃 西瓜</span></span><br></pre></td></tr></table></figure>
<h2 id="高阶柯里化函数"><a href="#高阶柯里化函数" class="headerlink" title="高阶柯里化函数"></a>高阶柯里化函数</h2><p>以上柯里化函数已经能解决一般需求了，但是如果要多层的柯里化总不能不断地进行currying函数的嵌套吧，我们希望经过柯里化之后的函数每次只传递一个或者多个参数，那该怎么做呢：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curryingHelper</span>(<span class="params">fn, len</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> length = len || fn.length  <span class="comment">// 第一遍运行length是函数fn一共需要的参数个数，以后是剩余所需要的参数个数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> rest.length &gt;= length    <span class="comment">// 检查是否传入了fn所需足够的参数</span></span><br><span class="line">        ? fn.apply(<span class="keyword">this</span>, rest)</span><br><span class="line">        : curryingHelper(currying.apply(<span class="keyword">this</span>, [fn].concat(rest)), length - rest.length)        <span class="comment">// 在通用currying函数基础上</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">name, age, fruit</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">`我叫 <span class="subst">$&#123;name&#125;</span>,我 <span class="subst">$&#123;age&#125;</span> 岁了, 我喜欢吃 <span class="subst">$&#123;fruit&#125;</span>`</span>) &#125;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> betterShowMsg = curryingHelper(sayHello)</span><br><span class="line">betterShowMsg(<span class="string">'小衰'</span>, <span class="number">20</span>, <span class="string">'西瓜'</span>)      <span class="comment">// 我叫 小衰,我 20 岁了, 我喜欢吃 西瓜</span></span><br><span class="line">betterShowMsg(<span class="string">'小猪'</span>)(<span class="number">25</span>, <span class="string">'南瓜'</span>)      <span class="comment">// 我叫 小猪,我 25 岁了, 我喜欢吃 南瓜</span></span><br><span class="line">betterShowMsg(<span class="string">'小明'</span>, <span class="number">22</span>)(<span class="string">'倭瓜'</span>)      <span class="comment">// 我叫 小明,我 22 岁了, 我喜欢吃 倭瓜</span></span><br><span class="line">betterShowMsg(<span class="string">'小拽'</span>)(<span class="number">28</span>)(<span class="string">'冬瓜'</span>)      <span class="comment">// 我叫 小拽,我 28 岁了, 我喜欢吃 冬瓜</span></span><br></pre></td></tr></table></figure>
<h2 id="疯狂柯里化函数"><a href="#疯狂柯里化函数" class="headerlink" title="疯狂柯里化函数"></a>疯狂柯里化函数</h2><p>尽管柯里化函数已经很牛了，但是它也让你必须花费点小心思在你所定义函数的参数顺序上。在一些函数式编程语言中，会定义一个特殊的“占位变量”。通常会指定下划线来干这事，如果作为一个函数的参数被传入，就表明这个是可以“跳过的”，是尚待指定的参数。比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sendAjax = <span class="function"><span class="keyword">function</span> (<span class="params">url, data, options</span>) </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"><span class="keyword">var</span> sendPost = <span class="function"><span class="keyword">function</span> (<span class="params">url, data</span>) </span>&#123;                    <span class="comment">// 当然可以这样</span></span><br><span class="line">    <span class="keyword">return</span> sendAjax(url, data, &#123; <span class="attr">type</span>: <span class="string">"POST"</span>, <span class="attr">contentType</span>: <span class="string">"application/json"</span> &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 也可以使用下划线来指定未确定的参数</span></span><br><span class="line"><span class="keyword">var</span> sendPost = sendAjax( _ , _ , &#123; <span class="attr">type</span>: <span class="string">"POST"</span>, <span class="attr">contentType</span>: <span class="string">"application/json"</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>JS不具备这样的原生支持，可以使用一个全局占位符变量const _ = { }并且通过===来判断是否是占位符，当然你如果使用了lodash的话可以使用别的符号代替。那么可以这样改造柯里化函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">crazyCurryingHelper</span>(<span class="params">fn, length, args, holes</span>) </span>&#123;</span><br><span class="line">  length = length || fn.length    <span class="comment">// 第一遍是fn所需的参数个数，以后是</span></span><br><span class="line">  args = args || []</span><br><span class="line">  holes = holes || []</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _args = args.slice(),</span><br><span class="line">        _holes = holes.slice(),</span><br><span class="line">        argLength = _args.length,        <span class="comment">// 存储接收到的args和holes的长度</span></span><br><span class="line">        holeLength = _holes.length,</span><br><span class="line">        arg, i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (; i &lt; rest.length; i++) &#123;</span><br><span class="line">      arg = rest[i]</span><br><span class="line">      <span class="keyword">if</span> (arg === _ &amp;&amp; holeLength) &#123;</span><br><span class="line">        holeLength--                      <span class="comment">// 循环_holes的位置</span></span><br><span class="line">        _holes.push(_holes.shift())      <span class="comment">// _holes最后一个移到第一个</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arg === _) &#123;</span><br><span class="line">        _holes.push(argLength + i)          <span class="comment">// 存储_hole就是_的位置</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (holeLength) &#123;              <span class="comment">// 是否还有没有填补的hole</span></span><br><span class="line">        holeLength--</span><br><span class="line">        _args.splice(_holes.shift(), <span class="number">0</span>, arg)           <span class="comment">// 在参数列表指定hole的地方插入当前参数</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _args.push(arg)            <span class="comment">// 不需要填补hole,直接添加到参数列表里面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> _args.length &gt;= length                          <span class="comment">// 递归的进行柯里化</span></span><br><span class="line">        ? fn.apply(<span class="keyword">this</span>, _args)</span><br><span class="line">        : crazyCurryingHelper.call(<span class="keyword">this</span>, fn, length, _args, _holes)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params">name, age, fruit</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">`我叫 <span class="subst">$&#123;name&#125;</span>,我 <span class="subst">$&#123;age&#125;</span> 岁了, 我喜欢吃 <span class="subst">$&#123;fruit&#125;</span>`</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> betterShowMsg = crazyCurryingHelper(sayHello)</span><br><span class="line">betterShowMsg(_, <span class="number">20</span>)(<span class="string">'小衰'</span>, _, <span class="string">'西瓜'</span>)          <span class="comment">// 我叫 小衰,我 20 岁了, 我喜欢吃 西瓜</span></span><br><span class="line">betterShowMsg(_, _, <span class="string">'南瓜'</span>)(<span class="string">'小猪'</span>)(<span class="number">25</span>)          <span class="comment">// 我叫 小猪,我 25 岁了, 我喜欢吃 南瓜</span></span><br><span class="line">betterShowMsg(<span class="string">'小明'</span>)(_, <span class="number">22</span>)(_, _, <span class="string">'倭瓜'</span>)          <span class="comment">// 我叫 小明,我 22 岁了, 我喜欢吃 倭瓜</span></span><br><span class="line">betterShowMsg(<span class="string">'小拽'</span>)(<span class="number">28</span>)(<span class="string">'冬瓜'</span>)          <span class="comment">// 我叫 小拽,我 28 岁了, 我喜欢吃 冬瓜</span></span><br></pre></td></tr></table></figure>
<h2 id="柯里化的常见用法"><a href="#柯里化的常见用法" class="headerlink" title="柯里化的常见用法"></a>柯里化的常见用法</h2><h3 id="参数复用"><a href="#参数复用" class="headerlink" title="参数复用"></a>参数复用</h3><p>通过柯里化方法，缓存参数到闭包内部参数，然后在函数内部将缓存的参数与传入的参数组合后apply/bind/call给函数执行，来实现参数的复用，降低适用范围，提高适用性。</p>
<p>参看以下栗子，官员无论添加后续老婆，都能和合法老婆组合，通过柯里化方法，getWife方法就无需添加多余的合法老婆…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> currying = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)      <span class="comment">// fn 指官员消化老婆的手段,args 指的是那个合法老婆</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newArgs = args.concat(...rest)        <span class="comment">// 已经有的老婆和新搞定的老婆们合成一体，方便控制</span></span><br><span class="line">    <span class="keyword">return</span> fn.apply(<span class="literal">null</span>, newArgs)        <span class="comment">// 这些老婆们用 fn 这个手段消化利用，完成韦小宝前辈的壮举并返回</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getWife = currying(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log([...arguments].join(<span class="string">';'</span>))          <span class="comment">// allwife 就是所有的老婆的，包括暗渡陈仓进来的老婆</span></span><br><span class="line">&#125;, <span class="string">'合法老婆'</span>)</span><br><span class="line"></span><br><span class="line">getWife(<span class="string">'老婆1'</span>, <span class="string">'老婆2'</span>, <span class="string">'老婆3'</span>)      <span class="comment">// 合法老婆;老婆1;老婆2;老婆3</span></span><br><span class="line">getWife(<span class="string">'超越韦小宝的老婆'</span>)             <span class="comment">// 合法老婆;超越韦小宝的老婆</span></span><br><span class="line">getWife(<span class="string">'超级老婆'</span>)                    <span class="comment">// 合法老婆;超级老婆</span></span><br></pre></td></tr></table></figure>
<h3 id="提高适用性"><a href="#提高适用性" class="headerlink" title="提高适用性"></a>提高适用性</h3><p>通用函数解决了兼容性问题，但同时也会再来，使用的不便利性，不同的应用场景往，要传递很多参数，以达到解决特定问题的目的。有时候应用中，同一种规则可能会反复使用，这就可能会造成代码的重复性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未柯里化前</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">i</span>) </span>&#123; <span class="keyword">return</span> i * i; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dubble</span>(<span class="params">i</span>) </span>&#123; <span class="keyword">return</span> i * <span class="number">2</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">handler, list</span>) </span>&#123; <span class="keyword">return</span> list.map(handler); &#125;</span><br><span class="line"></span><br><span class="line">map(square, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);        <span class="comment">// 数组的每一项平方</span></span><br><span class="line">map(square, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line">map(dubble, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);        <span class="comment">// 数组的每一项加倍</span></span><br><span class="line">map(dubble, [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br></pre></td></tr></table></figure>
<p>同一规则重复使用，带来代码的重复性，因此可以使用上面的通用柯里化实现改造一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 柯里化后</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span>(<span class="params">i</span>) </span>&#123; <span class="keyword">return</span> i * i; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dubble</span>(<span class="params">i</span>) </span>&#123; <span class="keyword">return</span> i * <span class="number">2</span>; &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">handler, ...list</span>) </span>&#123; <span class="keyword">return</span> list.map(handler); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mapSQ = currying(map, square);</span><br><span class="line">mapSQ([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">mapSQ([<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mapDB = currying(map, dubble);</span><br><span class="line">mapDB([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">mapDB([<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br></pre></td></tr></table></figure></p>
<h3 id="延迟执行"><a href="#延迟执行" class="headerlink" title="延迟执行"></a>延迟执行</h3><p>柯里化的另一个应用场景是延迟执行。不断的柯里化，累积传入的参数，最后执行。例如累加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curryAdd = <span class="function"><span class="keyword">function</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _args = rest</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rest.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> _args.reduce(<span class="function">(<span class="params">sum, single</span>) =&gt;</span> sum += single)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _args.push(...rest)</span><br><span class="line">      <span class="keyword">return</span> cb</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;()                        <span class="comment">// 为了保存添加的数，这里要返回一个闭包</span></span><br><span class="line">curryAdd(<span class="number">1</span>)</span><br><span class="line">curryAdd(<span class="number">2</span>)</span><br><span class="line">curryAdd(<span class="number">3</span>)</span><br><span class="line">curryAdd(<span class="number">4</span>)</span><br><span class="line">curryAdd()</span><br></pre></td></tr></table></figure>
<p>更通用的写法，将处理函数提取出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curry = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> _args = []</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rest.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, _args)</span><br><span class="line">    &#125;</span><br><span class="line">    _args.push(...rest)</span><br><span class="line">    <span class="keyword">return</span> cb</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curryAdd = curry(<span class="function">(<span class="params">...T</span>) =&gt;</span> </span><br><span class="line">  T.reduce(<span class="function">(<span class="params">sum, single</span>) =&gt;</span> sum += single)</span><br><span class="line">)</span><br><span class="line">curryAdd(<span class="number">1</span>)</span><br><span class="line">curryAdd(<span class="number">2</span>)</span><br><span class="line">curryAdd(<span class="number">3</span>)</span><br><span class="line">curryAdd(<span class="number">4</span>)</span><br><span class="line">curryAdd()               <span class="comment">// 最后计算输出:10</span></span><br></pre></td></tr></table></figure>
<h3 id="函数柯里化的递归调用"><a href="#函数柯里化的递归调用" class="headerlink" title="函数柯里化的递归调用"></a>函数柯里化的递归调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"> seed </span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">retVal</span>(<span class="params"> later </span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> add( seed + later );</span><br><span class="line">    &#125;</span><br><span class="line">    retVal.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> seed;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>).toString()); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>每调用一次add函数，都会返回retValue函数；调用retValue函数会调用add函数，然后还是返回retValue函数，所以调用add的结果一定是返回一个retValue函数。add函数的存在意义只是为了提供闭包，这个类似的递归调用每次调用add都会生成一个新的闭包。</p>
<h3 id="函数组合-compose"><a href="#函数组合-compose" class="headerlink" title="函数组合(compose)"></a>函数组合(compose)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> compose = <span class="function"><span class="keyword">function</span>(<span class="params">f,g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> f1 = compose(f,g);</span><br><span class="line">f1(x);</span><br></pre></td></tr></table></figure>
<p>将传入的函数变成两个，通过组合的方式返回一个新的函数，让代码从右向左运行，而不是从内向外运行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非 pointfree，因为提到了数据：name</span></span><br><span class="line"><span class="keyword">var</span> initials = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name.split(<span class="string">' '</span>).map(compose(toUpperCase, head)).join(<span class="string">'. '</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pointfree</span></span><br><span class="line"><span class="keyword">var</span> initials = compose(join(<span class="string">'. '</span>), map(compose(toUpperCase, head)), split(<span class="string">' '</span>));</span><br><span class="line"></span><br><span class="line">initials(<span class="string">"hunter stockton thompson"</span>);</span><br><span class="line"><span class="comment">// 'H. S. T'</span></span><br></pre></td></tr></table></figure>
<h3 id="Function-prototype-bind-方法也是柯里化应用"><a href="#Function-prototype-bind-方法也是柯里化应用" class="headerlink" title="Function.prototype.bind 方法也是柯里化应用"></a>Function.prototype.bind 方法也是柯里化应用</h3><p>与 call/apply 方法直接执行不同，bind 方法将第一个参数设置为函数执行的上下文，其他参数依次传递给调用方法（函数的主体本身不执行，可以看成是延迟执行），并动态创建返回一个新的函数， 这符合柯里化特点。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;<span class="attr">x</span>: <span class="number">888</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;.bind(foo);              <span class="comment">// 绑定</span></span><br><span class="line">bar();                    <span class="comment">// 888</span></span><br></pre></td></tr></table></figure></p>
<p>下面是一个 bind 函数的模拟，testBind 创建并返回新的函数，在新的函数中将真正要执行业务的函数绑定到实参传入的上下文，延迟执行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.testBind = <span class="function"><span class="keyword">function</span>(<span class="params">scope</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.apply(scope)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo = &#123; <span class="attr">x</span>: <span class="number">888</span> &#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x)</span><br><span class="line">&#125;.testBind(foo)              <span class="comment">// 绑定</span></span><br><span class="line">bar()                    <span class="comment">// 888</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/javascript/">javascript</a></div><div class="post-nav"><a class="pre" href="/2020/05/22/js-parseInt-and-map/">js parseInt和map函数</a><a class="next" href="/2020/05/18/js-closures/">闭包</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/categories/">categories</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/IM/" style="font-size: 15px;">IM</a> <a href="/tags/WebRTC/" style="font-size: 15px;">WebRTC</a> <a href="/tags/Promise/" style="font-size: 15px;">Promise</a> <a href="/tags/console/" style="font-size: 15px;">console</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/web3/" style="font-size: 15px;">web3</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/资料/" style="font-size: 15px;">资料</a> <a href="/tags/cavnas/" style="font-size: 15px;">cavnas</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/题库/" style="font-size: 15px;">题库</a> <a href="/tags/redux/" style="font-size: 15px;">redux</a> <a href="/tags/html/" style="font-size: 15px;">html</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/08/27/eip-712/">了解 EIP712</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/08/16/truffle-use/">Truffle的简单使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/10/30/nextjs-and-cms/">Nextjs + Tailwind css + Strapi CMS 使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/06/24/date-timezone/">将 JavaScript 日期初始化为特定时区</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/30/directory-structure/">项目目录结构推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/09/input-blur/">input 失去焦点重复校验</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/09/tampermonkey/">油猴脚本教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/09/auto-jump-history/">页面加载时使用脚本自动跳转到新页面浏览器不会产生历史记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/08/flex-finally-width/">关于flex布局的最后一行元素宽度问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/07/ unicode/">Unicode编码和解码</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.baidu.com/" title="百度" target="_blank">百度</a><ul></ul><a href="https://translate.google.cn/#en/zh-CN" title="谷歌翻译" target="_blank">谷歌翻译</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><div id="landlord"><div class="message"></div><canvas class="live2d" id="live2d" width="280" height="250"></canvas></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script type="text/javascript" src="//lib.baomitu.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/contextMenu.js?v=0.0.0"></script><script type="text/javascript" src="/js/live2d.js?v=0.0.0"></script><script type="text/javascript" src="/js/message.js?v=0.0.0"></script></div></body></html>